<div class="row">
  <content class="col-md-12" role="main">
    <div class="page-header">
      <h1>Alarm Statistics</h1>
    </div>

    <script src="/javascript/chartkick.js"></script>
    <%= column_chart @groups.map { |group| {
        name: group.name,
        data: @stats.alerts_by_group_and_day(group_id: group.id, since_days: 60).map { |day|
          [day['_id']['day'], day["sum"]]
        }.reverse
      }},
     defer: true %>
    <br>

    <section class="col-md-6">
      <h3>Alarms by Group last 7 days</h3>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Pos.</th>
            <th>Group</th>
            <th># Alerts</th>
          </tr>
        </thead>
        <tbody>
          <% @stats.alerts_by_group.each_with_index do |group, i| %>
            <tr>
              <td><%= i + 1 %></td>
              <td>
                <a href="/groups/<%= group["_id"] %>">
                  <%= @groups.detect{|g| g.id == group["_id"] }.name %>
                </a>
              </td>
              <td>
                <span class="badge"><%= group["sum"] %></span>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </section>

    <section class="col-md-6">
      <h3>Top Alarms last 30 days</h3>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Pos.</th>
            <th>Service</th>
            <th># Alerts</th>
          </tr>
        </thead>
        <tbody>
          <% @stats.alerts_by_service.each_with_index do |service, i| %>
            <tr>
              <td><%= i + 1 %></td>
              <td>
                <%= service["_id"] %>
              </td>
              <td>
                <span class="badge"><%= service["sum"] %></span>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </section>

  </content>
</div>
